function report(e,t=!1,n="info",o=!1){procMsg="ab¢6: "+e,console.log(procMsg),t||$.notify({message:procMsg},{type:n,placement:{align:"center"}}),o&&new Notification("ab¢6 Auto-attendance",{body:e,icon:"/favicon.ico"})}function parseTime(e){let t=new Date,[n,o]=e.split(":");return t.setHours(n),t.setMinutes(o),t.setSeconds("00"),t}function getTodayCourses(e=!1){let t=document.getElementsByTagName("table")[0],n=t.getElementsByClassName("bg-info")[0],o=[];if(e&&(n=t.getElementsByTagName("td")[0]),null==n)throw"No active date on calendar.";let r=n.getElementsByClassName("linkpertemuan");for(let e=0;e<r.length;e++){course=[];let t=r[e].innerText.split(" ")[0],n=parseTime(t.split("-")[0]),s=parseTime(t.split("-")[1]),a=r[e].getAttribute("data-url").split("?")[0],i=r[e].getAttribute("data-kuliah").match(/^(\S+)\s(.*)/).slice(1),u=i[0],d=i[1];course.push(n),course.push(s),course.push(a),course.push(u),course.push(d),course.push(null),o.push(course)}if(o==[])throw"No course found";return o}function getHTMLtxt(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&t("<div>"+this.responseText+"</div>")},n.open("GET",e,!0),n.send()}function markPresent(e){var t=e[2],n=function(n){var o=$.parseHTML(n)[0].getElementsByTagName("form")[0],r=(new Date).getTime(),s=e[1].getTime();if(report(e[3]+": "+e[4]+" now active!",!0,"info",!0),null==o)r>s+60*end_offset*1e3?(e[5]=3,report(e[3]+": Attendance probably already ended. Sorry.",!1,"danger",!0)):(e[5]=1,report(e[3]+": Attendance not open",!1,"warning"));else if(action_string=o.textContent.trim(),"Tandai Hadir"==action_string){let n=o.getElementsByTagName("input")[1],r=new XMLHttpRequest,s="";r.open("POST",t,!0),r.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s+=encodeURI("form[hadir]")+"=&",s+=encodeURI("form[returnTo]")+"="+encodeURIComponent(t)+"&",s+=encodeURI("form[_token]")+"="+encodeURIComponent(n.getAttribute("value")),r.onreadystatechange=function(){4==this.readyState&&200==this.status?-1!=this.responseText.search("Tandai Tidak Hadir")&&(e[5]=0,report(e[3]+": Attendance successful",!1,"success",!0)):200==this.status||(404==this.status?(e[5]=-1,report(e[3]+": A not found error has occured. Please reload the page.",!1,"danger",!0)):(e[5]=-1,report(e[3]+": An unknown error has occured. Please reload the page.",!1,"danger",!0)))},r.send(s)}else e[5]=2,report(e[3]+": Already attended",!1,"info",!0)},o=function(){var r=setTimeout(()=>{-1!=e[5]&&1!=e[5]||(getHTMLtxt(t,n),o())},60*repeat_delay*1e3);timeouts.push(r)};getHTMLtxt(t,n),o()}function untilEvent(e){var t=(new Date).getTime(),n=e[0].getTime(),o=e[1].getTime();return[n-t+6e4*start_offset,o-t+6e4*end_offset]}function main(e){for(let t=0;t<e.length;t++)t_diff=untilEvent(e[t]),t_diff[0]>0?(report(e[t][3]+": Scheduled attendance",!1),timeouts.push(setTimeout(()=>{markPresent(e[t])},t_diff[0]))):t_diff[0]<=0&&t_diff[1]>=0?(report("Attending "+e[t][3],!1,"info"),markPresent(e[t])):report("Skipping "+e[t][3],!0,"info")}chrome.runtime.onMessage.addListener(function(e,t,n){if(!t.tab){report("Config updated.",!1,"info",!0),start_offset=e[0],end_offset=e[1],repeat_delay=e[2];for(var o=0;o<timeouts.length;o++)clearTimeout(timeouts[o]);timeouts=[],main(courses)}}),report("Auto-attendance has been loaded.",!1,"info",!0),start_offset=1,end_offset=5,repeat_delay=5,timeouts=[],courses=[];try{courses=getTodayCourses()}catch{report("There is no active date today.")}main(courses);