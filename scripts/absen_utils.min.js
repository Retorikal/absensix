function report(e,t=!1,n="info"){console.log("ab¢6: "+e),t||$.notify({message:"ab¢6: "+e},{type:n,placement:{align:"center"}})}function parseTime(e){let t=new Date,[n,r]=e.split(":");return t.setHours(n),t.setMinutes(r),t.setSeconds("00"),t}function getTodayCourses(e=!1){let t=document.getElementsByTagName("table")[0],n=t.getElementsByClassName("bg-info")[0],r=[];if(e&&(n=t.getElementsByTagName("td")[0]),null==n)throw"No active date on calendar.";let o=n.getElementsByClassName("linkpertemuan");for(let e=0;e<o.length;e++){course=[];let t=o[e].innerText.split(" ")[0],n=parseTime(t.split("-")[0]),s=parseTime(t.split("-")[1]),a=o[e].getAttribute("data-url").split("?")[0],i=o[e].getAttribute("data-kuliah").match(/^(\S+)\s(.*)/).slice(1),u=i[0],d=i[1];course.push(n),course.push(s),course.push(a),course.push(u),course.push(d),course.push(null),r.push(course)}if(r==[])throw"No course found";return r}function getHTMLtxt(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&t("<div>"+this.responseText+"</div>")},n.open("GET",e,!0),n.send()}function markPresent(e){var t=e[2],n=function(n){var r=$.parseHTML(n)[0].getElementsByTagName("form")[0],o=(new Date).getTime(),s=e[1].getTime();if(null==r)o>s+60*end_offset*1e3?(e[5]=3,report(e[3]+": Attendance probably already ended. Sorry.",!1,"danger")):(e[5]=1,report(e[3]+": Attendance not open",!1,"warning"));else if(action_string=r.textContent.trim(),"Tandai Hadir"==action_string){let n=r.getElementsByTagName("input")[1],o=new XMLHttpRequest,s="";o.open("POST",t,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s+=encodeURI("form[hadir]")+"=&",s+=encodeURI("form[returnTo]")+"="+encodeURIComponent(t)+"&",s+=encodeURI("form[_token]")+"="+encodeURIComponent(n.getAttribute("value")),o.onreadystatechange=function(){4==this.readyState&&200==this.status?-1!=this.responseText.search("Tandai Tidak Hadir")&&(e[5]=0,report(e[3]+": Success",!1,"success")):200==this.status||(404==this.status?(e[5]=-1,report(e[3]+": A not found error has occured",!1,"danger")):(e[5]=-1,report(e[3]+": An unknown error has occured",!1,"danger")))},o.send(s)}else e[5]=2,report(e[3]+": Already attended",!1,"info")},r=function(){setTimeout(()=>{-1!=e[5]&&1!=e[5]||(getHTMLtxt(t,n),r())},60*repeat_delay*1e3)};getHTMLtxt(t,n),r()}function untilEvent(e){var t=(new Date).getTime(),n=e[0].getTime(),r=e[1].getTime();return[n-t+6e4*start_offset,r-t+6e4*end_offset]}function main(e){for(let t=0;t<e.length;t++)t_diff=untilEvent(e[t]),t_diff[0]>0?(report(e[t][3]+": Scheduled attendance",!0),setTimeout(()=>{markPresent(e[t])},t_diff[0])):t_diff[0]<=0&&t_diff[1]>=0?(report("Attending "+e[t][3],!1,"info"),markPresent(e[t])):report("Skipping "+e[t][3],!0,"info")}report("Auto-attendance has been loaded."),start_offset=1,end_offset=5,repeat_delay=5;try{courses=getTodayCourses(),main(courses)}catch{report("There is no active date today.")}function report(e,t=!1,n="info"){console.log("ab¢6: "+e),t||$.notify({message:"ab¢6: "+e},{type:n,placement:{align:"center"}})}function parseTime(e){let t=new Date,[n,r]=e.split(":");return t.setHours(n),t.setMinutes(r),t.setSeconds("00"),t}function getTodayCourses(e=!1){let t=document.getElementsByTagName("table")[0],n=t.getElementsByClassName("bg-info")[0],r=[];if(e&&(n=t.getElementsByTagName("td")[0]),null==n)throw"No active date on calendar.";let o=n.getElementsByClassName("linkpertemuan");for(let e=0;e<o.length;e++){course=[];let t=o[e].innerText.split(" ")[0],n=parseTime(t.split("-")[0]),s=parseTime(t.split("-")[1]),a=o[e].getAttribute("data-url").split("?")[0],i=o[e].getAttribute("data-kuliah").match(/^(\S+)\s(.*)/).slice(1),u=i[0],d=i[1];course.push(n),course.push(s),course.push(a),course.push(u),course.push(d),course.push(null),r.push(course)}if(r==[])throw"No course found";return r}function getHTMLtxt(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&t("<div>"+this.responseText+"</div>")},n.open("GET",e,!0),n.send()}function markPresent(e){var t=e[2],n=function(n){var r=$.parseHTML(n)[0].getElementsByTagName("form")[0],o=(new Date).getTime(),s=e[1].getTime();if(null==r)o>s+60*end_offset*1e3?(e[5]=3,report(e[3]+": Attendance probably already ended. Sorry.",!1,"danger")):(e[5]=1,report(e[3]+": Attendance not open",!1,"warning"));else if(action_string=r.textContent.trim(),"Tandai Hadir"==action_string){let n=r.getElementsByTagName("input")[1],o=new XMLHttpRequest,s="";o.open("POST",t,!0),o.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s+=encodeURI("form[hadir]")+"=&",s+=encodeURI("form[returnTo]")+"="+encodeURIComponent(t)+"&",s+=encodeURI("form[_token]")+"="+encodeURIComponent(n.getAttribute("value")),o.onreadystatechange=function(){4==this.readyState&&200==this.status?-1!=this.responseText.search("Tandai Tidak Hadir")&&(e[5]=0,report(e[3]+": Success",!1,"success")):200==this.status||(404==this.status?(e[5]=-1,report(e[3]+": A not found error has occured",!1,"danger")):(e[5]=-1,report(e[3]+": An unknown error has occured",!1,"danger")))},o.send(s)}else e[5]=2,report(e[3]+": Already attended",!1,"info")},r=function(){setTimeout(()=>{-1!=e[5]&&1!=e[5]||(getHTMLtxt(t,n),r())},60*repeat_delay*1e3)};getHTMLtxt(t,n),r()}function untilEvent(e){var t=(new Date).getTime(),n=e[0].getTime(),r=e[1].getTime();return[n-t+6e4*start_offset,r-t+6e4*end_offset]}function main(e){for(let t=0;t<e.length;t++)t_diff=untilEvent(e[t]),t_diff[0]>0?(report(e[t][3]+": Scheduled attendance",!0),setTimeout(()=>{markPresent(e[t])},t_diff[0])):t_diff[0]<=0&&t_diff[1]>=0?(report("Attending "+e[t][3],!1,"info"),markPresent(e[t])):report("Skipping "+e[t][3],!0,"info")}report("Auto-attendance has been loaded."),start_offset=1,end_offset=5,repeat_delay=5;try{courses=getTodayCourses(),main(courses)}catch{report("There is no active date today.")}