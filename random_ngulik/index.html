<!DOCTYPE html>
<html>
<head>
	<title></title>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">

	<!--Script-script ini ada di web SIX dan diperlukan buat reproduce behaviour-->
	<script src="./jquery-3.5.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
	<script>
		$(document).ready(function() {
			$("a.linkpertemuan").on("click", function (e) {
				e.preventDefault();
				var url = $(this).data("url");
				var kuliah = $(this).data("kuliah");

				$.alert({
					title: kuliah,
					backgroundDismiss: true,
					content: function () {
						var self = this;
						return $.ajax({
							url: url,
							dataType: 'html',
							method: 'get'
						}).done(function (response) {
							self.setContent(response);
							self.setTitle(response.name);
						}).fail(function(){
							self.setContent('Something went wrong.');
						});
					},
					buttons: {
						close: {
							text: 'Tutup',
							keys: ['enter', 'esc']
						}
					}
				});
			});
		});
	</script>

	<!--Script implementasi: BUAT DIPAKE DI WEB SIX (coba dites di F12 -> console, copas fungsi ini, terus ketik getTodayNode())-->
	<script type="text/javascript">
		// Get td node that contains today's attendance link
		// For use at startup, and repeats when passing 00:00
		function getTodayNode(){
			var calendar = document.getElementsByTagName("table")[0];
			var currentDate = var today = calendar.getElementsByClassName("bg-info"); // Di web SiX warna tanggal hari ini beda
			
			return currentDate;
		}

		// url : target url
		// callback: function with 1 string input. Callback will receive the string.
		function loadHTMLtxt(url, callback) {
  			var xhttp = new XMLHttpRequest();
  			
  			xhttp.onreadystatechange = function() {
    			if (this.readyState == 4 && this.status == 200) {
      				callback("<div>" + this.responseText + "</div>");
    			}
  			};

  			//xhttp.open("GET", "/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/460679/93642", true);
  			xhttp.open("GET", url, true);
  			xhttp.send();
		}

		function markPresent(url){
			//var targetUrl = url
			var targetUrl = "/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/460679/93642";
			var success = 1;
			/* Error codes
			 * -1 	= Others
			 * 0 	= Success
			 * 1 	= Not open
			 * 2 	= Attended
			 */

			var callback = function(txt) {
    			var todayDOM = $.parseHTML(txt)[0]; // Ini fungsi jquery. Iya syntaxnya pake "$" gitu :/ SiX uda paketan sama jquery jadi sans
    			submit_form = todayDOM.getElementsByTagName("form")[0];
				
				if (submit_form == undefined){<!DOCTYPE html>
<html>
<head>
	<title></title>

	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">

	<!--Script-script ini ada di web SIX dan diperlukan buat reproduce behaviour-->
	<script src="./jquery-3.5.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>
	<script>
		$(document).ready(function() {
			$("a.linkpertemuan").on("click", function (e) {
				e.preventDefault();
				var url = $(this).data("url");
				var kuliah = $(this).data("kuliah");

				$.alert({
					title: kuliah,
					backgroundDismiss: true,
					content: function () {
						var self = this;
						return $.ajax({
							url: url,
							dataType: 'html',
							method: 'get'
						}).done(function (response) {
							self.setContent(response);
							self.setTitle(response.name);
						}).fail(function(){
							self.setContent('Something went wrong.');
						});
					},
					buttons: {
						close: {
							text: 'Tutup',
							keys: ['enter', 'esc']
						}
					}
				});
			});
		});
	</script>

	<!--Script implementasi: BUAT DIPAKE DI WEB SIX (coba dites di F12 -> console, copas fungsi ini, terus ketik getTodayNode())-->
	<script type="text/javascript">
		// Get td node that contains today's attendance link
		// For use at startup, and repeats when passing 00:00
		function getTodayNode(){
			var calendar = document.getElementsByTagName("table")[0];
			var currentDate = var today = calendar.getElementsByClassName("bg-info"); // Di web SiX warna tanggal hari ini beda
			
			return currentDate;
		}

		// url : target url
		// callback: function with 1 string input. Callback will receive the string.
		function getHTMLtxt(url, callback) {
  			var xhttp = new XMLHttpRequest();
  			
  			xhttp.onreadystatechange = function() {
    			if (this.readyState == 4 && this.status == 200) {
      				callback("<div>" + this.responseText + "</div>");
    			}
  			};

  			//xhttp.open("GET", "/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/460679/93642", true);
  			xhttp.open("GET", url, true);
  			xhttp.send();
		}

		// Accepts <a> node containing relevant information, and mark attend from there
		function markPresent(a_node){
			var url = a_node.getAttribute("data-url").split('?')[0]
			var success = 1;
			/* Error codes
			 * -1 	= Others
			 * 0 	= Success
			 * 1 	= Not open
			 * 2 	= Attended
			 */

			var callback = function(txt) {
    			var todayDOM = $.parseHTML(txt)[0]; // Ini fungsi jquery. Iya syntaxnya pake "$" gitu :/ SiX uda paketan sama jquery jadi sans
    			submit_form = todayDOM.getElementsByTagName("form")[0];
				
				if (submit_form == undefined){
					// Tombolnya gaada, absensi belum dibuka
					success = 1;

				} else {
					action_string = submit_form.textContent.trim()

					if (action_string == "Tandai Hadir") {
						// Bisa menandai hadir. Langsung gow
						let in_tok = submit_form.getElementById("form__token");
						let submit_xhttp = new XMLHttpRequest();
						let submit_params = ""

						submit_params += "form[hadir]=&";
						submit_params += "form[returnTo]=" + url + "&";
						submit_params += "form[_token]=" + url + in_tok.getAttribute("value");

						submit_xhttp.onreadystatechange = function() {
    						if (this.readyState == 4 && this.status == 302) {
      							if(this.responseText.search("Tandai Tidak Hadir") != -1){
      								success = 0;
      							}
    						}
  						};

  						submit_xhttp.open('POST', url, true);
  						submit_xhttp.send(submit_params);
					} else {
						// Tulisanya "Tandai Tidak Hadir"; berati sudah diabsen
						success = 2;
					}
				}
  			};

			getHTMLtxt(url, callback);
		}

	</script>
</head>
<body>

	<div title="Dinamika Sistem dan Simulasi">
		<a 
			class="linkpertemuan" 
			href="#" 
			data-kuliah="TF3101 Dinamika Sistem dan Simulasi" 
			data-url="/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/459877/93642?returnTo=/app/mahasiswa:13318056%2B2020-1/kelas/pertemuan/jadwal/mahasiswa">
		<small>
                                    11:00-12:00
                                    <strong>TF3101</strong>
                                    Dinamika Sis...
		</small>
		</a>
	</div>

	<div title="Dinamika Sistem dan Simulasi">
		<a 
			class="linkpertemuan" 
			href="https://akademik.itb.ac.id/app/mahasiswa:13318056+2020-1/kelas/pertemuan/jadwal/mahasiswa#" 
			data-kuliah="TF3101 Dinamika Sistem dan Simulasi" 
			data-url="/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/459877/93642?returnTo=/app/mahasiswa:13318056%2B2020-1/kelas/pertemuan/jadwal/mahasiswa">
		<small>
                                    11:00-12:00
                                    <strong>TF3101</strong>
                                    Dinamika Sis...
		</small>
		</a>
	</div>
	
	<!--
		Catatan: implementasi autologin
		Site: https://login.itb.ac.id/cas/login
		Flowchart:
			- Buka tab baru https://login.itb.ac.id/cas/login
			- Autoclick login
			- Close popup
	-->

	<!--
		Daftar fungsi yang mungkin terpakai
		- Buat check setiap berapa lama sekali
			var autorun = setInterval(func, t): 
			clearInterval(autorun);

			// Bisa dipake buat tombol semacem "Check now!" yang ngecek presensi terus reset interval

		- Autoclicker
	-->

	<!--
		Catatan
		Isi kotak konfirmasi kuliah bisa diakses dengan (Harus diakses dalam kondisi logged in):
			https://akademik.itb.ac.id/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/459877/93642
			format: https://akademik.itb.ac.id/app/mahasiswa:<nim>+<tahun>-<semester>/kelas/pertemuan/mhs/<id1>/<id2>
				Ket:
					nim			: nim
					tahun		: tahun ajaran
					semester	: semester
					id1			: probably id pertemuan
					id2			: probably id mahasiswa
		Informasi ini didapatkan dari:
			a (class: linkpertemuan), bagian data-url
	-->

	
</body>
</html>

				}
  			};

			loadHTMLtxt(targetUrl, callback);
		}

	</script>
</head>
<body>

	<div title="Dinamika Sistem dan Simulasi">
		<a 
			class="linkpertemuan" 
			href="#" 
			data-kuliah="TF3101 Dinamika Sistem dan Simulasi" 
			data-url="/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/459877/93642?returnTo=/app/mahasiswa:13318056%2B2020-1/kelas/pertemuan/jadwal/mahasiswa">
		<small>
                                    11:00-12:00
                                    <strong>TF3101</strong>
                                    Dinamika Sis...
		</small>
		</a>
	</div>

	<div title="Dinamika Sistem dan Simulasi">
		<a 
			class="linkpertemuan" 
			href="https://akademik.itb.ac.id/app/mahasiswa:13318056+2020-1/kelas/pertemuan/jadwal/mahasiswa#" 
			data-kuliah="TF3101 Dinamika Sistem dan Simulasi" 
			data-url="/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/459877/93642?returnTo=/app/mahasiswa:13318056%2B2020-1/kelas/pertemuan/jadwal/mahasiswa">
		<small>
                                    11:00-12:00
                                    <strong>TF3101</strong>
                                    Dinamika Sis...
		</small>
		</a>
	</div>
	
	<!--
		Catatan: implementasi autologin
		Site: https://login.itb.ac.id/cas/login
		Flowchart:
			- Buka tab baru https://login.itb.ac.id/cas/login
			- Autoclick login
			- Close popup
	-->

	<!--
		Daftar fungsi yang mungkin terpakai
		- Buat check setiap berapa lama sekali
			var autorun = setInterval(func, t): 
			clearInterval(autorun);

			// Bisa dipake buat tombol semacem "Check now!" yang ngecek presensi terus reset interval

		- Autoclicker
	-->

	<!--
		Catatan
		Isi kotak konfirmasi kuliah bisa diakses dengan (Harus diakses dalam kondisi logged in):
			https://akademik.itb.ac.id/app/mahasiswa:13318056+2020-1/kelas/pertemuan/mhs/459877/93642
			format: https://akademik.itb.ac.id/app/mahasiswa:<nim>+<tahun>-<semester>/kelas/pertemuan/mhs/<id1>/<id2>
				Ket:
					nim			: nim
					tahun		: tahun ajaran
					semester	: semester
					id1			: probably id pertemuan
					id2			: probably id mahasiswa
		Informasi ini didapatkan dari:
			a (class: linkpertemuan), bagian data-url
	-->

	
</body>
</html>