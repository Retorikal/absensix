function report(e){$.notify("abÂ¢6: "+e)}function parseTime(e){let t=new Date,[n,r]=e.split(":");return t.setHours(n),t.setMinutes(r),t.setSeconds("00"),t}function getTodayCourses(e=!1){let t=document.getElementsByTagName("table")[0],n=t.getElementsByClassName("bg-info")[0],r=[];if(e&&(n=t.getElementsByTagName("td")[0]),null==n)throw"No active date on calendar.";let s=n.getElementsByClassName("linkpertemuan");for(let e=0;e<s.length;e++){course=[];let t=s[e].innerText.split(" ")[0],n=parseTime(t.split("-")[0]),a=parseTime(t.split("-")[1]),o=s[e].getAttribute("data-url").split("?")[0],i=s[e].getAttribute("data-kuliah").match(/^(\S+)\s(.*)/).slice(1),u=i[0],d=i[1];course.push(n),course.push(a),course.push(o),course.push(u),course.push(d),course.push(null),r.push(course)}if(r==[])throw"No course found";return r}function getHTMLtxt(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4==this.readyState&&200==this.status&&t("<div>"+this.responseText+"</div>")},n.open("GET",e,!0),n.send()}function markPresent(e){var t=e[2],n=function(n){var r=$.parseHTML(n)[0].getElementsByTagName("form")[0],s=(new Date).getTime(),a=e[1].getTime();if(null==r)s>a?(e[5]=3,report("Attendance probably already ended. Sorry.")):(e[5]=1,report("Attendance not open"));else if(action_string=r.textContent.trim(),"Tandai Hadir"==action_string){let n=r.getElementById("form__token"),s=new XMLHttpRequest,a="";a+="form[hadir]=&",a+="form[returnTo]="+t+"&",a+="form[_token]="+t+n.getAttribute("value"),s.onreadystatechange=function(){4==this.readyState&&302==this.status?-1!=this.responseText.search("Tandai Tidak Hadir")&&(e[5]=0,report("Success")):(e[5]=-1,report("An unknown error has occured"))},s.open("POST",t,!0),s.send(a)}else e[5]=2,report("Already attended")},r=function(e){setTimeout(()=>{0==e[5]&&2==e[5]&&3==e[5]||(getHTMLtxt(t,n),r(e))},48e4)};getHTMLtxt(t,n),r(e)}function untilEvent(e){var t=(new Date).getTime();return[e[0].getTime()-t+12e4,e[1].getTime()-t]}function main(e){for(let t=e.length-1;t>=0;t--)t_diff=untilEvent(e[t]),t_diff[0]>0?(report("Scheduled attendance for "+e[t][3]),setTimeout(()=>{markPresent(e[t])},t_diff[0])):t_diff[0]<=0&&t_diff[1]>=0?(report("Attending "+e[t][3]),markPresent(e[t])):(report("Skipping "+e[t][3]),e.splice(t,1))}report("Auto-attendance has been loaded.");try{courses=getTodayCourses(),main(courses)}catch{report("There is no active date today.")}